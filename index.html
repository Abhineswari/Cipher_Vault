<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CipherVault - Educational Cryptography Suite</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .cipher-selector {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .cipher-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            background: rgba(255,255,255,0.2);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.3);
        }

        .cipher-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .cipher-btn.active {
            background: rgba(255,255,255,0.9);
            color: #333;
            border-color: rgba(255,255,255,0.8);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .panel {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .panel h3 {
            margin-bottom: 20px;
            color: #333;
            font-size: 1.4rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .input-group input, .input-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus, .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn.secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .btn.danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
        }

        .visualization {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .visualization h3 {
            margin-bottom: 20px;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .char-mapping {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .char-pair {
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #e9ecef;
            font-family: monospace;
            font-size: 14px;
        }

        .frequency-chart {
            display: flex;
            align-items: end;
            justify-content: space-between;
            height: 200px;
            border-bottom: 2px solid #333;
            border-left: 2px solid #333;
            padding: 10px;
            margin: 20px 0;
        }

        .frequency-bar {
            background: linear-gradient(to top, #667eea, #764ba2);
            min-width: 20px;
            margin: 0 1px;
            border-radius: 2px 2px 0 0;
            position: relative;
            transition: all 0.3s ease;
        }

        .frequency-bar:hover {
            background: linear-gradient(to top, #f093fb, #f5576c);
        }

        .frequency-label {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            font-weight: bold;
        }

        .attack-results {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .attack-results h3 {
            color: #333;
            margin-bottom: 20px;
            border-bottom: 2px solid #f5576c;
            padding-bottom: 10px;
        }

        .attack-result {
            background: #f8f9fa;
            padding: 10px;
            margin: 10px 0;
            border-radius: 6px;
            border-left: 4px solid #667eea;
            font-family: monospace;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        .key-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 2px dashed #667eea;
            margin: 15px 0;
            font-family: monospace;
            text-align: center;
            font-size: 1.1rem;
            color: #333;
        }

        .input-mode-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .mode-btn {
            padding: 8px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 20px;
            background: white;
            color: #333;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .mode-btn:hover {
            border-color: #667eea;
        }

        .mode-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .input-mode {
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .file-info {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            border: 1px solid #e9ecef;
            font-size: 0.9rem;
        }

        .file-preview {
            margin-top: 15px;
            border: 2px dashed #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            background: #fafafa;
        }

        .file-preview img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .file-preview video {
            max-width: 100%;
            max-height: 200px;
            border-radius: 6px;
        }

        .file-preview audio {
            width: 100%;
            margin: 10px 0;
        }

        .file-icon {
            font-size: 3rem;
            color: #667eea;
            margin-bottom: 10px;
        }

        .file-result-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #e9ecef;
        }

        .encryption-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }

        .stat-box {
            background: white;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
            text-align: center;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }

        .binary-preview {
            background: #2d2d2d;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            padding: 15px;
            border-radius: 6px;
            font-size: 0.8rem;
            max-height: 150px;
            overflow-y: auto;
            margin: 10px 0;
            line-height: 1.4;
        }

        .warning-file {
            background: rgba(255, 152, 0, 0.1);
            border: 1px solid rgba(255, 152, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            color: #333;
        }
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .cipher-selector {
                flex-direction: column;
                align-items: center;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        

        .hidden {
            display: none;
        }

        .info-box {
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            color: #333;
        }

        .warning-box {
            background: rgba(245, 87, 108, 0.1);
            border: 1px solid rgba(245, 87, 108, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔐 CipherVaultX</h1>
            <p>Educational Cryptography Suite for Secure Communication</p>
        </div>

        <div class="cipher-selector">
            <button class="cipher-btn active" onclick="switchCipher('caesar')">Caesar Cipher</button>
            <button class="cipher-btn" onclick="switchCipher('vigenere')">Vigenère Cipher</button>
            <button class="cipher-btn" onclick="switchCipher('aes')">AES Encryption</button>
        </div>

        <div class="main-content">
            <div class="panel">
                <h3>Encryption/Decryption</h3>
                
                <div class="input-mode-selector">
                    <button class="mode-btn active" onclick="switchMode('text')">📝 Text</button>
                    <button class="mode-btn" onclick="switchMode('file')">📁 File</button>
                </div>
                
                <div id="text-mode" class="input-mode">
                    <div class="input-group">
                        <label for="message">Message:</label>
                        <textarea id="message" placeholder="Enter your message here..."></textarea>
                    </div>
                </div>
                
                <div id="file-mode" class="input-mode hidden">
                    <div class="input-group">
                        <label for="file-input">Select File:</label>
                        <input type="file" id="file-input" accept="*/*" onchange="handleFileSelect(event)">
                        <div class="file-info" id="file-info"></div>
                    </div>
                    
                    <div id="file-preview" class="file-preview"></div>
                </div>

                <div id="caesar-controls" class="cipher-controls">
                    <div class="input-group">
                        <label for="caesar-shift">Shift Value (1-25):</label>
                        <input type="number" id="caesar-shift" min="1" max="25" value="3">
                    </div>
                </div>

                <div id="vigenere-controls" class="cipher-controls hidden">
                    <div class="input-group">
                        <label for="vigenere-key">Key:</label>
                        <input type="text" id="vigenere-key" placeholder="Enter key (letters only)">
                    </div>
                </div>

                <div id="aes-controls" class="cipher-controls hidden">
                    <div class="input-group">
                        <label for="aes-key">AES Key (32 characters):</label>
                        <input type="text" id="aes-key" placeholder="Enter 32-character key or generate one">
                        <button class="btn secondary" onclick="generateAESKey()">Generate Random Key</button>
                    </div>
                </div>

                <div>
                    <button class="btn" onclick="encrypt()">🔐 Encrypt</button>
                    <button class="btn" onclick="decrypt()">🔓 Decrypt</button>
                    <button class="btn secondary" onclick="clearAll()">🗑️ Clear</button>
                    <button class="btn secondary" onclick="downloadResult()" id="download-btn" style="display: none;">💾 Download</button>
                </div>

                <div class="key-display" id="generated-key" style="display: none;">
                    Generated Key: <span id="key-value"></span>
                </div>
            </div>

            <div class="panel">
                <h3>Result</h3>
                <div id="text-result" class="result-mode">
                    <div class="input-group">
                        <label for="result">Output:</label>
                        <textarea id="result" readonly></textarea>
                    </div>
                    <button class="btn secondary" onclick="copyResult()">📋 Copy Result</button>
                    <button class="btn secondary" onclick="swapMessages()">🔄 Use as Input</button>
                </div>
                
                <div id="file-result" class="result-mode hidden">
                    <div class="file-result-info" id="file-result-info"></div>
                    <div id="file-result-preview" class="file-preview"></div>
                </div>
            </div>
        </div>

        <div class="visualization">
            <h3>Character Mapping Visualization</h3>
            <div id="char-mapping" class="char-mapping"></div>
            <div class="info-box" id="cipher-info">
                <strong>Caesar Cipher:</strong> A simple substitution cipher where each letter is shifted by a fixed number of positions in the alphabet.
            </div>
        </div>

        <div class="visualization">
            <h3>Frequency Analysis</h3>
            <button class="btn" onclick="analyzeFrequency()">📊 Analyze Text</button>
            <div id="frequency-chart" class="frequency-chart"></div>
            <div class="info-box">
                Frequency analysis can help break substitution ciphers by comparing letter frequencies to natural language patterns.
            </div>
        </div>

        <div class="attack-results" id="attack-section">
            <h3>🚨 Brute Force Attack Simulation</h3>
            <button class="btn danger" onclick="bruteForceAttack()">Launch Attack</button>
            <div class="progress-bar">
                <div class="progress-fill" id="attack-progress"></div>
            </div>
            <div id="attack-results"></div>
            <div class="warning-box">
                <strong>Educational Purpose:</strong> This demonstrates why simple ciphers like Caesar are vulnerable to brute force attacks.
            </div>
        </div>
    </div>

    <script>
        let currentCipher = 'caesar';
        let currentMode = 'text';
        let attackInProgress = false;
        let currentFile = null;
        let encryptedFileData = null;

        // Simple AES implementation (educational - not cryptographically secure)
        class SimpleAES {
            static encrypt(text, key) {
                if (key.length !== 32) return "Key must be exactly 32 characters";
                let result = '';
                for (let i = 0; i < text.length; i++) {
                    const textChar = text.charCodeAt(i);
                    const keyChar = key.charCodeAt(i % key.length);
                    result += String.fromCharCode(textChar ^ keyChar);
                }
                return btoa(result); // Base64 encode
            }

            static decrypt(encryptedText, key) {
                if (key.length !== 32) return "Key must be exactly 32 characters";
                try {
                    const decoded = atob(encryptedText);
                    let result = '';
                    for (let i = 0; i < decoded.length; i++) {
                        const encChar = decoded.charCodeAt(i);
                        const keyChar = key.charCodeAt(i % key.length);
                        result += String.fromCharCode(encChar ^ keyChar);
                    }
                    return result;
                } catch (e) {
                    return "Invalid encrypted text";
                }
            }

            static encryptBytes(bytes, key) {
                if (key.length !== 32) return null;
                const result = new Uint8Array(bytes.length);
                for (let i = 0; i < bytes.length; i++) {
                    const keyByte = key.charCodeAt(i % key.length);
                    result[i] = bytes[i] ^ keyByte;
                }
                return result;
            }

            static decryptBytes(encryptedBytes, key) {
                return this.encryptBytes(encryptedBytes, key); // XOR is symmetric
            }
        }

        function switchMode(mode) {
            currentMode = mode;
            
            // Update button states
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Hide all modes
            document.querySelectorAll('.input-mode').forEach(mode => mode.classList.add('hidden'));
            document.querySelectorAll('.result-mode').forEach(mode => mode.classList.add('hidden'));
            
            // Show selected mode
            document.getElementById(`${mode}-mode`).classList.remove('hidden');
            document.getElementById(`${mode}-result`).classList.remove('hidden');
            
            // Clear previous data
            clearAll();
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            currentFile = file;
            
            // Display file info
            const fileInfo = document.getElementById('file-info');
            fileInfo.innerHTML = `
                <strong>File:</strong> ${file.name}<br>
                <strong>Size:</strong> ${formatFileSize(file.size)}<br>
                <strong>Type:</strong> ${file.type || 'Unknown'}<br>
                <strong>Last Modified:</strong> ${new Date(file.lastModified).toLocaleDateString()}
            `;
            
            // Preview file
            previewFile(file);
            
            // Show binary preview for educational purposes
            showBinaryPreview(file);
        }

        function previewFile(file) {
            const preview = document.getElementById('file-preview');
            const fileType = file.type.split('/')[0];
            
            if (fileType === 'image') {
                const img = document.createElement('img');
                img.src = URL.createObjectURL(file);
                img.onload = () => URL.revokeObjectURL(img.src);
                preview.innerHTML = '';
                preview.appendChild(img);
            } else if (fileType === 'video') {
                const video = document.createElement('video');
                video.src = URL.createObjectURL(file);
                video.controls = true;
                video.onload = () => URL.revokeObjectURL(video.src);
                preview.innerHTML = '';
                preview.appendChild(video);
            } else if (fileType === 'audio') {
                const audio = document.createElement('audio');
                audio.src = URL.createObjectURL(file);
                audio.controls = true;
                audio.onload = () => URL.revokeObjectURL(audio.src);
                preview.innerHTML = '';
                preview.appendChild(audio);
            } else {
                preview.innerHTML = `
                    <div class="file-icon">${getFileIcon(file.type)}</div>
                    <div><strong>${file.name}</strong></div>
                    <div>${file.type || 'Unknown file type'}</div>
                `;
            }
        }

        function showBinaryPreview(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const bytes = new Uint8Array(e.target.result);
                const preview = document.getElementById('file-preview');
                
                // Show first 256 bytes as hex
                let hexString = '';
                const limit = Math.min(256, bytes.length);
                for (let i = 0; i < limit; i++) {
                    if (i % 16 === 0) hexString += '\n';
                    hexString += bytes[i].toString(16).padStart(2, '0').toUpperCase() + ' ';
                }
                
                const binaryDiv = document.createElement('div');
                binaryDiv.className = 'binary-preview';
                binaryDiv.innerHTML = `<strong>Binary Data Preview (first ${limit} bytes):</strong>${hexString}${bytes.length > 256 ? '\n... (truncated)' : ''}`;
                preview.appendChild(binaryDiv);
            };
            reader.readAsArrayBuffer(file.slice(0, 256));
        }

        function getFileIcon(type) {
            const icons = {
                'application/pdf': '📄',
                'application/msword': '📝',
                'application/vnd.openxmlformats-officedocument.wordprocessingml.document': '📝',
                'application/vnd.ms-excel': '📊',
                'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': '📊',
                'application/zip': '🗜️',
                'application/x-rar-compressed': '🗜️',
                'text/plain': '📄',
                'text/html': '🌐',
                'application/json': '⚙️'
            };
            
            if (type.startsWith('image/')) return '🖼️';
            if (type.startsWith('video/')) return '🎥';
            if (type.startsWith('audio/')) return '🎵';
            if (type.startsWith('text/')) return '📄';
            
            return icons[type] || '📁';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function switchCipher(cipher) {
            currentCipher = cipher;
            
            // Update button states
            document.querySelectorAll('.cipher-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Hide all controls
            document.querySelectorAll('.cipher-controls').forEach(control => control.classList.add('hidden'));
            
            // Show selected cipher controls
            document.getElementById(`${cipher}-controls`).classList.remove('hidden');
            
            // Update info box
            const infoBox = document.getElementById('cipher-info');
            const infos = {
                caesar: '<strong>Caesar Cipher:</strong> A simple substitution cipher where each letter is shifted by a fixed number of positions in the alphabet.',
                vigenere: '<strong>Vigenère Cipher:</strong> A polyalphabetic cipher that uses a keyword to determine different shift values for each character.',
                aes: '<strong>AES Encryption:</strong> Advanced Encryption Standard - a symmetric encryption algorithm used worldwide for secure communications.'
            };
            infoBox.innerHTML = infos[cipher];
            
            // Clear visualizations
            clearVisualizations();
        }

        function caesarCipher(text, shift, decrypt = false) {
            if (decrypt) shift = -shift;
            return text.replace(/[a-zA-Z]/g, char => {
                const isUpperCase = char === char.toUpperCase();
                const code = char.toLowerCase().charCodeAt(0);
                const shifted = ((code - 97 + shift + 26) % 26) + 97;
                const result = String.fromCharCode(shifted);
                return isUpperCase ? result.toUpperCase() : result;
            });
        }

        function vigenereCipher(text, key, decrypt = false) {
            if (!key) return "Key required";
            key = key.toLowerCase().replace(/[^a-z]/g, '');
            if (!key) return "Key must contain letters";
            
            let result = '';
            let keyIndex = 0;
            
            for (let char of text) {
                if (/[a-zA-Z]/.test(char)) {
                    const isUpperCase = char === char.toUpperCase();
                    const charCode = char.toLowerCase().charCodeAt(0) - 97;
                    const keyCode = key[keyIndex % key.length].charCodeAt(0) - 97;
                    
                    let shifted;
                    if (decrypt) {
                        shifted = (charCode - keyCode + 26) % 26;
                    } else {
                        shifted = (charCode + keyCode) % 26;
                    }
                    
                    const resultChar = String.fromCharCode(shifted + 97);
                    result += isUpperCase ? resultChar.toUpperCase() : resultChar;
                    keyIndex++;
                } else {
                    result += char;
                }
            }
            return result;
        }

        function encrypt() {
            if (currentMode === 'text') {
                encryptText();
            } else {
                encryptFile();
            }
        }

        function decrypt() {
            if (currentMode === 'text') {
                decryptText();
            } else {
                decryptFile();
            }
        }

        function encryptText() {
            const message = document.getElementById('message').value;
            if (!message) {
                alert('Please enter a message to encrypt');
                return;
            }

            let result;
            switch (currentCipher) {
                case 'caesar':
                    const shift = parseInt(document.getElementById('caesar-shift').value);
                    result = caesarCipher(message, shift);
                    visualizeCaesar(shift);
                    break;
                case 'vigenere':
                    const key = document.getElementById('vigenere-key').value;
                    result = vigenereCipher(message, key);
                    visualizeVigenere(message, key);
                    break;
                case 'aes':
                    const aesKey = document.getElementById('aes-key').value;
                    result = SimpleAES.encrypt(message, aesKey);
                    visualizeAES();
                    break;
            }
            
            document.getElementById('result').value = result;
        }

        function encryptFile() {
            if (!currentFile) {
                alert('Please select a file to encrypt');
                return;
            }

            if (currentCipher !== 'aes') {
                alert('File encryption is only supported with AES cipher');
                return;
            }

            const aesKey = document.getElementById('aes-key').value;
            if (aesKey.length !== 32) {
                alert('AES key must be exactly 32 characters');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const bytes = new Uint8Array(e.target.result);
                const encryptedBytes = SimpleAES.encryptBytes(bytes, aesKey);
                
                if (encryptedBytes) {
                    encryptedFileData = {
                        data: encryptedBytes,
                        originalName: currentFile.name,
                        originalType: currentFile.type,
                        originalSize: currentFile.size
                    };
                    
                    displayFileResult('encrypted', encryptedBytes, currentFile);
                    document.getElementById('download-btn').style.display = 'inline-block';
                } else {
                    alert('Encryption failed. Please check your key.');
                }
            };
            reader.readAsArrayBuffer(currentFile);
        }

        function decryptFile() {
            if (!currentFile) {
                alert('Please select an encrypted file to decrypt');
                return;
            }

            if (currentCipher !== 'aes') {
                alert('File decryption is only supported with AES cipher');
                return;
            }

            const aesKey = document.getElementById('aes-key').value;
            if (aesKey.length !== 32) {
                alert('AES key must be exactly 32 characters');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const encryptedBytes = new Uint8Array(e.target.result);
                const decryptedBytes = SimpleAES.decryptBytes(encryptedBytes, aesKey);
                
                if (decryptedBytes) {
                    encryptedFileData = {
                        data: decryptedBytes,
                        originalName: currentFile.name.replace('.encrypted', ''),
                        originalType: 'application/octet-stream', // We don't know the original type
                        originalSize: decryptedBytes.length
                    };
                    
                    displayFileResult('decrypted', decryptedBytes, currentFile);
                    document.getElementById('download-btn').style.display = 'inline-block';
                } else {
                    alert('Decryption failed. Please check your key.');
                }
            };
            reader.readAsArrayBuffer(currentFile);
        }

        function displayFileResult(operation, resultBytes, originalFile) {
            const resultInfo = document.getElementById('file-result-info');
            const resultPreview = document.getElementById('file-result-preview');
            
            const compressionRatio = ((originalFile.size - resultBytes.length) / originalFile.size * 100).toFixed(1);
            const encryptionTime = '< 1ms'; // Simulated for educational purposes
            
            resultInfo.innerHTML = `
                <div class="encryption-stats">
                    <div class="stat-box">
                        <div class="stat-value">${formatFileSize(resultBytes.length)}</div>
                        <div class="stat-label">${operation === 'encrypted' ? 'Encrypted' : 'Decrypted'} Size</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">${formatFileSize(originalFile.size)}</div>
                        <div class="stat-label">Original Size</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">${encryptionTime}</div>
                        <div class="stat-label">Process Time</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">${currentCipher.toUpperCase()}</div>
                        <div class="stat-label">Algorithm</div>
                    </div>
                </div>
                <div class="warning-file">
                    <strong>Note:</strong> This is an educational implementation. For real-world applications, use established cryptographic libraries and proper key management.
                </div>
            `;
            
            // Show encrypted data preview
            let hexString = '';
            const limit = Math.min(256, resultBytes.length);
            for (let i = 0; i < limit; i++) {
                if (i % 16 === 0) hexString += '\n';
                hexString += resultBytes[i].toString(16).padStart(2, '0').toUpperCase() + ' ';
            }
            
            resultPreview.innerHTML = `
                <div class="file-icon">${operation === 'encrypted' ? '🔐' : '🔓'}</div>
                <div><strong>${operation === 'encrypted' ? 'Encrypted' : 'Decrypted'} File Data</strong></div>
                <div class="binary-preview">
                    <strong>${operation === 'encrypted' ? 'Encrypted' : 'Decrypted'} Binary Data (first ${limit} bytes):</strong>${hexString}${resultBytes.length > 256 ? '\n... (truncated)' : ''}
                </div>
            `;
        }

        function downloadResult() {
            if (!encryptedFileData) {
                alert('No processed file data available');
                return;
            }
            
            const blob = new Blob([encryptedFileData.data]);
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = encryptedFileData.originalName + (encryptedFileData.originalName.includes('.encrypted') ? '' : '.encrypted');
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function decryptText() {
            const message = document.getElementById('message').value;
            if (!message) {
                alert('Please enter a message to decrypt');
                return;
            }

            let result;
            switch (currentCipher) {
                case 'caesar':
                    const shift = parseInt(document.getElementById('caesar-shift').value);
                    result = caesarCipher(message, shift, true);
                    visualizeCaesar(shift);
                    break;
                case 'vigenere':
                    const key = document.getElementById('vigenere-key').value;
                    result = vigenereCipher(message, key, true);
                    visualizeVigenere(message, key);
                    break;
                case 'aes':
                    const aesKey = document.getElementById('aes-key').value;
                    result = SimpleAES.decrypt(message, aesKey);
                    visualizeAES();
                    break;
            }
            
            document.getElementById('result').value = result;
        }

        function visualizeCaesar(shift) {
            const mapping = document.getElementById('char-mapping');
            mapping.innerHTML = '';
            
            for (let i = 0; i < 26; i++) {
                const original = String.fromCharCode(97 + i);
                const shifted = String.fromCharCode(97 + ((i + shift) % 26));
                
                const pair = document.createElement('div');
                pair.className = 'char-pair';
                pair.textContent = `${original.toUpperCase()} → ${shifted.toUpperCase()}`;
                mapping.appendChild(pair);
            }
        }

        function visualizeVigenere(message, key) {
            const mapping = document.getElementById('char-mapping');
            mapping.innerHTML = '';
            
            if (!key) return;
            
            let keyIndex = 0;
            for (let i = 0; i < Math.min(message.length, 20); i++) {
                const char = message[i];
                if (/[a-zA-Z]/.test(char)) {
                    const keyChar = key[keyIndex % key.length];
                    const shift = keyChar.toLowerCase().charCodeAt(0) - 97;
                    const originalCode = char.toLowerCase().charCodeAt(0) - 97;
                    const shiftedCode = (originalCode + shift) % 26;
                    const shifted = String.fromCharCode(shiftedCode + 97);
                    
                    const pair = document.createElement('div');
                    pair.className = 'char-pair';
                    pair.textContent = `${char.toUpperCase()} →${keyChar.toUpperCase()}→ ${shifted.toUpperCase()}`;
                    mapping.appendChild(pair);
                    keyIndex++;
                }
            }
        }

        function visualizeAES() {
            const mapping = document.getElementById('char-mapping');
            mapping.innerHTML = '<div class="char-pair">AES uses complex mathematical operations involving substitution boxes, permutations, and key schedules. Each block is processed through multiple rounds of encryption.</div>';
        }

        function analyzeFrequency() {
            const text = document.getElementById('message').value.toLowerCase();
            const frequencies = {};
            let letterCount = 0;
            
            for (let char of text) {
                if (/[a-z]/.test(char)) {
                    frequencies[char] = (frequencies[char] || 0) + 1;
                    letterCount++;
                }
            }
            
            const chart = document.getElementById('frequency-chart');
            chart.innerHTML = '';
            
            for (let i = 0; i < 26; i++) {
                const letter = String.fromCharCode(97 + i);
                const count = frequencies[letter] || 0;
                const percentage = letterCount > 0 ? (count / letterCount) * 100 : 0;
                
                const bar = document.createElement('div');
                bar.className = 'frequency-bar';
                bar.style.height = `${percentage * 8}px`;
                bar.title = `${letter.toUpperCase()}: ${count} (${percentage.toFixed(1)}%)`;
                
                const label = document.createElement('div');
                label.className = 'frequency-label';
                label.textContent = letter.toUpperCase();
                bar.appendChild(label);
                
                chart.appendChild(bar);
            }
        }

        function bruteForceAttack() {
            if (currentCipher !== 'caesar') {
                alert('Brute force simulation only available for Caesar cipher');
                return;
            }
            
            const message = document.getElementById('message').value;
            if (!message) {
                alert('Please enter a Caesar-encrypted message first');
                return;
            }
            
            if (attackInProgress) return;
            attackInProgress = true;
            
            const resultsDiv = document.getElementById('attack-results');
            const progressBar = document.getElementById('attack-progress');
            
            resultsDiv.innerHTML = '';
            progressBar.style.width = '0%';
            
            let shift = 1;
            const interval = setInterval(() => {
                const decrypted = caesarCipher(message, shift, true);
                
                const resultDiv = document.createElement('div');
                resultDiv.className = 'attack-result';
                resultDiv.innerHTML = `<strong>Shift ${shift}:</strong> ${decrypted}`;
                resultsDiv.appendChild(resultDiv);
                
                progressBar.style.width = `${(shift / 25) * 100}%`;
                
                shift++;
                if (shift > 25) {
                    clearInterval(interval);
                    attackInProgress = false;
                    progressBar.style.width = '100%';
                }
            }, 200);
        }

        function generateAESKey() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*';
            let key = '';
            for (let i = 0; i < 32; i++) {
                key += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            document.getElementById('aes-key').value = key;
            
            const keyDisplay = document.getElementById('generated-key');
            document.getElementById('key-value').textContent = key;
            keyDisplay.style.display = 'block';
        }

        function clearAll() {
            if (currentMode === 'text') {
                document.getElementById('message').value = '';
                document.getElementById('result').value = '';
            } else {
                document.getElementById('file-input').value = '';
                document.getElementById('file-info').innerHTML = '';
                document.getElementById('file-preview').innerHTML = '';
                document.getElementById('file-result-info').innerHTML = '';
                document.getElementById('file-result-preview').innerHTML = '';
                currentFile = null;
                encryptedFileData = null;
                document.getElementById('download-btn').style.display = 'none';
            }
            document.getElementById('generated-key').style.display = 'none';
            clearVisualizations();
        }

        function clearVisualizations() {
            document.getElementById('char-mapping').innerHTML = '';
            document.getElementById('frequency-chart').innerHTML = '';
            document.getElementById('attack-results').innerHTML = '';
            document.getElementById('attack-progress').style.width = '0%';
        }

        function copyResult() {
            const result = document.getElementById('result');
            result.select();
            document.execCommand('copy');
            alert('Result copied to clipboard!');
        }

        function swapMessages() {
            const message = document.getElementById('message').value;
            const result = document.getElementById('result').value;
            document.getElementById('message').value = result;
            document.getElementById('result').value = message;
        }

        // Initialize visualization
        visualizeCaesar(3);
    </script>
</body>
</html>